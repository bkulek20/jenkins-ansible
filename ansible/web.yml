# ðŸ”¸ Web arÅŸivini Ã¶nce localhost'tan EC2'ye gÃ¶ndermek iÃ§in ayrÄ± bir play
- name: Web arÅŸivini EC2'ye kopyala (lokalden)
  hosts: localhost
  connection: local
  tasks:
    - name: Web arÅŸivini EC2'ye kopyala
      copy:
        src: ../../static-site.tar.gz
        dest: /tmp/static-site.tar.gz

- name: EC2'de nginx kurulumu ve web iÃ§eriÄŸini Ã§Ä±karma
  hosts: web
  become: true
  vars:
    ansible_connection: amazon.aws.aws_ssm
    ansible_aws_ssm_bucket_name: bkulek-demo-jenkins
    ansible_aws_ssm_region: eu-central-1
    ansible_aws_ssm_timeout: 30

  tasks:
    - name: Nginx kur
      yum:
        name: nginx
        update_cache: yes
        state: present

    - name: Web iÃ§eriÄŸini Ã§Ä±kar
      unarchive:
        src: /tmp/static-site.tar.gz
        dest: /var/www/html/
        remote_src: yes

# - hosts: web
#   become: true
#   vars:
#     ansible_connection: amazon.aws.aws_ssm
#     # ansible_shell_type: powershell
#     ansible_aws_ssm_bucket_name: bkulek-demo-jenkins
#     ansible_aws_ssm_region: eu-central-1
#     ansible_aws_ssm_timeout: 30
#   tasks:
#     - name: Nginx kur
#       yum:
#         name: nginx
#         update_cache: yes
#         state: present

#     - name: Web arÅŸivini EC2'ye kopyala
#       copy:
#         src: ../static-site.tar.gz
#         dest: /tmp/static-site.tar.gz
#       delegate_to: localhost
#       connection: local

#     - name: Web iÃ§eriÄŸini Ã§Ä±kar
#       unarchive:
#         src: /tmp/static-site.tar.gz
#         dest: /var/www/html/
#         remote_src: yes

    # - name: Web dosyalarÄ±nÄ± rsync ile kopyala
    #   synchronize:
    #     src: "{{ playbook_dir }}/../"
    #     dest: /var/www/html/
    #     recursive: yes
    #     delete: no
    #     rsync_opts:
    #       - "--exclude=.terraform"
    #       - "--exclude=.git"
    #       - "--exclude=__pycache__"
    #       - "--exclude=ansible"
    #       - "--exclude=*.tf"
    #       - "--exclude=*.py"
    #       - "--exclude=*.yml"
    #       - "--exclude=*.yaml"
    #       - "--exclude=*.conf"
    #       - "--exclude=*.tfstate*"
    #       - "--exclude=Dockerfile"
    #       - "--exclude=plugins.txt"
    #       - "--exclude=lambda_function.py"
    #       - "--exclude=flask_app.py"
